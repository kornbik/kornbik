- name: Authenticate to Google Cloud
  uses: google-github-actions/auth@v0.4.0
jobs:

  job_id:

    # ...

    # Add "id-token" with the intended permissions.

    permissions:

      contents: 'read'

      id-token: 'write'

    steps:

    - id: 'auth'

      name: 'Authenticate to Google Cloud'

      uses: 'google-github-actions/auth@v0.4.0'

      with:

        token_format: 'access_token'

        workload_identity_provider: 'projects/123456789/locations/global/workloadIdentityPools/my-pool/providers/my-provider'

        service_account: 'my-service-account@my-project.iam.gserviceaccount.com'

    # Example of using the token:

    - name: 'Access secret'

      run: |-

        curl https://secretmanager.googleapis.com/v1/projects/my-project/secrets/my-secret/versions/1:access \

          --header "Authorization: Bearer ${{ steps.auth.outputs.access_token }}"

